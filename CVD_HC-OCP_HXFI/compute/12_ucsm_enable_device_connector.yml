---

- name: Enable Device Connector on UCSM if it is not enabled already
  block: 
    - name: Enable device connector 
      uri:
        url: "https://{{ inventory_hostname }}/connector/Systems"
        method: PUT
        headers:
          Content-Type: application/json
          ucsmcookie: "ucsm-cookie={{ hostvars['DUMMY_HOST']['ucsm_cookie'] }}"
        body: "{\"AdminState\": true}"
        status_code: 200
        return_content: yes
        validate_certs: no
      register: response
      
    - name: Output of device connector 
      debug: "Device Connector response is: {{ response.json[0] }}"

    - name: Pause for Device Connector to enable
      pause:
        seconds: 30

  when: device_connector_status != "Claimed"
    

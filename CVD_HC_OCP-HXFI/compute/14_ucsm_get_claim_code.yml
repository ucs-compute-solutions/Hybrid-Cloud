---

- name: Get Claim Code from UCSM
  block:
    - name: Get Claim Code
      uri:
        url: "https://{{ inventory_hostname }}/connector/SecurityTokens"
        method: GET
        headers:
          Content-Type: application/json
          ucsmcookie: "ucsm-cookie={{ hostvars['DUMMY_HOST']['ucsm_cookie'] }}"
        status_code: 200
        return_content: yes
        validate_certs: no
      register: response
    - name: Show an attribute value
      debug:
        msg: "{{ response.json[0].Token  }}"
    - name: Extract claim code
      set_fact:
        claim_code: "{{ response.json[0].Token }}"
      #when: ansible_facts['account_ownership_state'] != 'Claimed'
      #when: hostvars['DUMMY_HOST']['account_ownership_state'] != 'Claimed'
  when: device_connector_status != "Claimed"
  
    








---

- name: Define anchor for Intersight API login info 
  set_fact:
    intersight_api_login_info: &intersight_api_login_info
      api_private_key:    "{{ intersight_api_private_key }}"
      api_key_id:         "{{ intersight_api_key_id }}"
      api_uri:            "{{ intersight_api_uri | default(omit) }}"
      validate_certs: "{{ intersight_validate_certs | default(omit) }}"
      #state:          "{{ intersight_state | default(omit) }}"

# - debug:
#     msg: "API Info is: {{ intersight_api_login_info }}"

- name: Claim new Target
  cisco.intersight.intersight_target_claim:
    <<: *intersight_api_login_info
    device_id: "{{ device_id }}"
    claim_code: "{{ claim_code }}"
    state: present
  tags: Ansible
  when: hostvars['DUMMY_HOST']['device_connector_status'] != "Claimed"
  #when: ansible_facts['account_ownership_state'] != 'Claimed'


# Add TASK TO MOVE HOSTS TO CORRECT RESOURCE GROUP AND ORG





# - name: Show an attribute value - account state
#   debug:
#     msg: "CLAIM_TARGET_DUMMY_HOST: {{ hostvars['DUMMY_HOST']['account_ownership_state'] }}"

# - name: Show an attribute value - intersight api info
#   debug:
#     msg: "CLAIM_TARGET_DUMMY_HOST: {{ hostvars.DUMMY_HOST.intersight_api_info }}"







